<!doctype html>
<html lang="ms" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Borang Tajaan Berbuka Puasa Ramadan 1447H</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&amp;family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    .font-amiri {
      font-family: 'Amiri', serif;
    }
    
    .font-inter {
      font-family: 'Inter', sans-serif;
    }
    
    .islamic-pattern {
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4af37' fill-opacity='0.08'%3E%3Cpath d='M30 0L60 30L30 60L0 30z M30 10L50 30L30 50L10 30z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }
    
    .menu-card {
      transition: all 0.3s ease;
    }
    
    .menu-card:hover:not(.opacity-50) {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.15);
    }
    
    .menu-card.selected {
      border-color: #d4af37;
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.3);
    }
    
    .date-btn {
      transition: all 0.2s ease;
    }
    
    .date-btn:hover:not(:disabled) {
      transform: scale(1.05);
    }
    
    .date-btn.selected {
      background: linear-gradient(135deg, #1a4d3a 0%, #0d3325 100%);
      color: white;
      border-color: #d4af37;
    }
    
    .date-btn:disabled {
      background-color: #6b7280;
      color: #9ca3af;
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    .step-indicator {
      transition: all 0.3s ease;
    }
    
    .step-indicator.active {
      background: linear-gradient(135deg, #d4af37 0%, #b8960c 100%);
      color: #0d3325;
    }
    
    .step-indicator.completed {
      background: #1a4d3a;
      color: white;
    }
    
    .upload-zone {
      border: 2px dashed #1a4d3a;
      transition: all 0.3s ease;
    }
    
    .upload-zone:hover {
      border-color: #d4af37;
      background-color: rgba(212, 175, 55, 0.05);
    }
    
    .upload-zone.drag-over {
      border-color: #d4af37;
      background-color: rgba(212, 175, 55, 0.1);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #1a4d3a 0%, #0d3325 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, #236b50 0%, #1a4d3a 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(13, 51, 37, 0.4);
    }
    
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .pulse-gold {
      animation: pulseGold 2s infinite;
    }
    
    @keyframes pulseGold {
      0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(212, 175, 55, 0); }
    }
    
    .toast {
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .shimmer {
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      background-size: 200% 100%;
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    .star {
      animation: twinkle 3s infinite ease-in-out;
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.4; transform: scale(0.8); }
    }
    
    .float {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    .glow {
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
    }

    .debug-btn {
      display: none; /* Disembunyikan di production */
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full font-inter bg-gradient-to-br from-emerald-950 via-emerald-900 to-emerald-950 islamic-pattern">
  <div id="app" class="h-full overflow-auto"><!-- Header -->
   <header class="bg-gradient-to-r from-emerald-950 to-emerald-900 border-b border-amber-600/30 sticky top-0 z-50 backdrop-blur-sm bg-opacity-95">
    <div class="max-w-4xl mx-auto px-4 py-4">
     <div class="text-center">
      <div class="inline-flex items-center justify-center mb-2 relative">
       <svg class="w-6 h-6 text-amber-300 star absolute -top-1 -left-6" style="animation-delay: 0s;" viewbox="0 0 24 24" fill="currentColor"><path d="M12 2l2.4 7.4h7.6l-6 4.6 2.3 7-6.3-4.6-6.3 4.6 2.3-7-6-4.6h7.6z" />
       </svg>
       <svg class="w-4 h-4 text-amber-200 star absolute -top-2 left-2" style="animation-delay: 1s;" viewbox="0 0 24 24" fill="currentColor"><path d="M12 2l2.4 7.4h7.6l-6 4.6 2.3 7-6.3-4.6-6.3 4.6 2.3-7-6-4.6h7.6z" />
       </svg>
       <svg class="w-8 h-8 text-amber-400 mr-2 float" viewbox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z" />
       </svg>
       <svg class="w-10 h-10 text-amber-400 glow" viewbox="0 0 24 24" fill="currentColor"><path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 3z" />
       </svg>
       <svg class="w-8 h-8 text-amber-400 ml-2 float" style="animation-delay: 1s;" viewbox="0 0 24 24" fill="currentColor"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
       </svg>
       <svg class="w-4 h-4 text-amber-200 star absolute -top-2 right-2" style="animation-delay: 0.5s;" viewbox="0 0 24 24" fill="currentColor"><path d="M12 2l2.4 7.4h7.6l-6 4.6 2.3 7-6.3-4.6-6.3 4.6 2.3-7-6-4.6h7.6z" />
       </svg>
       <svg class="w-6 h-6 text-amber-300 star absolute -top-1 -right-6" style="animation-delay: 1.5s;" viewbox="0 0 24 24" fill="currentColor"><path d="M12 2l2.4 7.4h7.6l-6 4.6 2.3 7-6.3-4.6-6.3 4.6 2.3-7-6-4.6h7.6z" />
       </svg>
      </div>
      <h1 id="main-title" class="font-amiri text-2xl md:text-3xl font-bold text-amber-400 leading-tight shimmer">Borang Tajaan Berbuka Puasa Ramadan 1447H</h1>
      <p id="surau-name" class="text-emerald-200 text-sm md:text-base mt-1">Surau Al-Furqan Presint 11, Putrajaya</p>
     </div>
    </div>
   </header><!-- Step Indicator -->
   <div class="max-w-4xl mx-auto px-4 py-6">
    <div class="flex items-center justify-center space-x-2 md:space-x-4">
     <div id="step-1-indicator" class="step-indicator active flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full text-sm md:text-base font-semibold">
      1
     </div>
     <div class="h-1 w-8 md:w-16 bg-emerald-800 rounded"></div>
     <div id="step-2-indicator" class="step-indicator flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full bg-emerald-800 text-emerald-400 text-sm md:text-base font-semibold">
      2
     </div>
     <div class="h-1 w-8 md:w-16 bg-emerald-800 rounded"></div>
     <div id="step-3-indicator" class="step-indicator flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full bg-emerald-800 text-emerald-400 text-sm md:text-base font-semibold">
      3
     </div>
     <div class="h-1 w-8 md:w-16 bg-emerald-800 rounded"></div>
     <div id="step-4-indicator" class="step-indicator flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full bg-emerald-800 text-emerald-400 text-sm md:text-base font-semibold">
      4
     </div>
    </div>
    <div class="flex justify-center mt-2 text-xs md:text-sm text-emerald-300"><span class="w-16 md:w-24 text-center">Menu</span> <span class="w-16 md:w-24 text-center">Tarikh</span> <span class="w-16 md:w-24 text-center">Maklumat</span> <span class="w-16 md:w-24 text-center">Bayaran</span>
    </div>
   </div><!-- Main Content -->
   <main class="max-w-4xl mx-auto px-4 pb-8">
    <form id="sponsorship-form" class="space-y-6"><!-- Step 1: Menu Selection -->
     <section id="step-1" class="fade-in bg-white/95 backdrop-blur rounded-2xl shadow-xl p-6 border border-amber-200">
      <div class="flex items-center mb-6">
       <div class="bg-gradient-to-br from-amber-400 to-amber-600 p-3 rounded-xl mr-4">
        <svg class="w-6 h-6 text-emerald-900" viewbox="0 0 24 24" fill="currentColor"><path d="M8.1 13.34l2.83-2.83L3.91 3.5c-1.56 1.56-1.56 4.09 0 5.66l4.19 4.18zm6.78-1.81c1.53.71 3.68.21 5.27-1.38 1.91-1.91 2.28-4.65.81-6.12-1.46-1.46-4.20-1.10-6.12.81-1.59 1.59-2.09 3.74-1.38 5.27L3.7 19.87l1.41 1.41L12 14.41l6.88 6.88 1.41-1.41L13.41 13l1.47-1.47z" />
        </svg>
       </div>
       <div>
        <h2 class="text-xl md:text-2xl font-bold text-emerald-900">Pilih Menu Tajaan</h2>
        <p class="text-emerald-600 text-sm">Sila pilih satu menu untuk ditaja</p>
       </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><!-- Menu Ayam --> <label class="menu-card cursor-pointer block bg-gradient-to-br from-amber-50 to-white rounded-xl border-2 border-amber-200 p-5 relative overflow-hidden hover:glow" data-menu="ayam"> <input type="radio" name="menu" value="ayam" class="sr-only" required>
        <div class="absolute top-0 right-0 w-20 h-20 bg-amber-400/10 rounded-bl-full shimmer"></div>
        <div class="text-center">
         <div class="text-4xl mb-3">
          üçó
         </div>
         <h3 class="font-bold text-lg text-emerald-900 mb-1">Menu Ayam</h3>
         <p class="text-2xl font-bold text-amber-600 mb-2">RM4,200</p>
         <div class="inline-flex items-center bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full text-sm">
          <svg class="w-4 h-4 mr-1" fill="currentColor" viewbox="0 0 20 20"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
          </svg> 400 pax
         </div>
        </div>
        <div class="absolute bottom-2 right-2 w-6 h-6 rounded-full border-2 border-amber-400 flex items-center justify-center check-circle">
         <svg class="w-4 h-4 text-amber-600 hidden check-icon" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
         </svg>
        </div></label> <!-- Menu Daging --> <label class="menu-card cursor-pointer block bg-gradient-to-br from-amber-50 to-white rounded-xl border-2 border-amber-200 p-5 relative overflow-hidden hover:glow" data-menu="daging"> <input type="radio" name="menu" value="daging" class="sr-only">
        <div class="absolute top-0 right-0 w-20 h-20 bg-amber-400/10 rounded-bl-full shimmer"></div>
        <div class="text-center">
         <div class="text-4xl mb-3">
          ü•©
         </div>
         <h3 class="font-bold text-lg text-emerald-900 mb-1">Menu Daging</h3>
         <p class="text-2xl font-bold text-amber-600 mb-2">RM4,550</p>
         <div class="inline-flex items-center bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full text-sm">
          <svg class="w-4 h-4 mr-1" fill="currentColor" viewbox="0 0 20 20"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
          </svg> 400 pax
         </div>
        </div>
        <div class="absolute bottom-2 right-2 w-6 h-6 rounded-full border-2 border-amber-400 flex items-center justify-center check-circle">
         <svg class="w-4 h-4 text-amber-600 hidden check-icon" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
         </svg>
        </div></label> <!-- Menu Kambing --> <label class="menu-card cursor-pointer block bg-gradient-to-br from-amber-50 to-white rounded-xl border-2 border-amber-200 p-5 relative overflow-hidden hover:glow" data-menu="kambing"> <input type="radio" name="menu" value="kambing" class="sr-only">
        <div class="absolute top-0 right-0 w-20 h-20 bg-amber-400/10 rounded-bl-full shimmer"></div>
        <div class="text-center">
         <div class="text-4xl mb-3">
          üêë
         </div>
         <h3 class="font-bold text-lg text-emerald-900 mb-1">Menu Kambing</h3>
         <p class="text-2xl font-bold text-amber-600 mb-2">RM4,900</p>
         <div class="inline-flex items-center bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full text-sm">
          <svg class="w-4 h-4 mr-1" fill="currentColor" viewbox="0 0 20 20"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
          </svg> 400 pax
         </div>
        </div>
        <div class="absolute bottom-2 right-2 w-6 h-6 rounded-full border-2 border-amber-400 flex items-center justify-center check-circle">
         <svg class="w-4 h-4 text-amber-600 hidden check-icon" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
         </svg>
        </div></label>
      </div>
      <div class="mt-6 flex justify-end"><button type="button" id="next-1" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold flex items-center disabled:opacity-50" disabled> Seterusnya 
        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg></button>
      </div>
     </section><!-- Step 2: Date Selection -->
     <section id="step-2" class="hidden fade-in bg-white/95 backdrop-blur rounded-2xl shadow-xl p-6 border border-amber-200">
      <div class="flex items-center mb-6">
       <div class="bg-gradient-to-br from-amber-400 to-amber-600 p-3 rounded-xl mr-4">
        <svg class="w-6 h-6 text-emerald-900" viewbox="0 0 24 24" fill="currentColor"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z" />
        </svg>
       </div>
       <div>
        <h2 class="text-xl md:text-2xl font-bold text-emerald-900">Pilih Tarikh Tajaan</h2>
        <p class="text-emerald-600 text-sm">Ramadan 1447H (19 Feb - 18 Mac 2026)</p>
       </div>
      </div>
      <div class="bg-gradient-to-br from-emerald-50 to-amber-50 rounded-xl p-4 mb-4">
       <div class="flex items-center justify-between mb-4">
        <h3 class="font-semibold text-emerald-900">Ramadan 1447H / 2026</h3>
        <div class="flex items-center space-x-4 text-xs"><span class="flex items-center"><span class="w-3 h-3 bg-emerald-700 rounded mr-1"></span>Tersedia</span> <span class="flex items-center"><span class="w-3 h-3 bg-gray-400 rounded mr-1"></span>Ditempah</span> <span class="flex items-center"><span class="w-3 h-3 bg-amber-500 rounded mr-1"></span>Dipilih</span>
        </div>
       </div>
       <div id="calendar-grid" class="grid grid-cols-7 gap-2"><!-- Calendar header -->
        <div class="text-center text-xs font-semibold text-emerald-700 py-2">
         Ahd
        </div>
        <div class="text-center text-xs font-semibold text-emerald-700 py-2">
         Isn
        </div>
        <div class="text-center text-xs font-semibold text-emerald-700 py-2">
         Sel
        </div>
        <div class="text-center text-xs font-semibold text-emerald-700 py-2">
         Rab
        </div>
        <div class="text-center text-xs font-semibold text-emerald-700 py-2">
         Kha
        </div>
        <div class="text-center text-xs font-semibold text-emerald-700 py-2">
         Jum
        </div>
        <div class="text-center text-xs font-semibold text-emerald-700 py-2">
         Sab
        </div><!-- Dates will be generated by JavaScript -->
       </div>
      </div>
      <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start">
       <svg class="w-5 h-5 text-amber-600 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
       </svg>
       <p class="text-sm text-amber-800">Tarikh akan dikunci selepas pengesahan bayaran penuh</p>
      </div><input type="hidden" id="selected-date" name="tarijah_tajaan" required>
      <div class="mt-6 flex justify-between"><button type="button" id="back-2" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-3 rounded-xl font-semibold flex items-center transition-all">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg> Kembali </button> <button type="button" id="next-2" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold flex items-center disabled:opacity-50" disabled> Seterusnya 
        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg></button>
      </div>
     </section><!-- Step 3: Sponsor Information -->
     <section id="step-3" class="hidden fade-in bg-white/95 backdrop-blur rounded-2xl shadow-xl p-6 border border-amber-200">
      <div class="flex items-center mb-6">
       <div class="bg-gradient-to-br from-amber-400 to-amber-600 p-3 rounded-xl mr-4">
        <svg class="w-6 h-6 text-emerald-900" viewbox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
        </svg>
       </div>
       <div>
        <h2 class="text-xl md:text-2xl font-bold text-emerald-900">Maklumat Penaja</h2>
        <p class="text-emerald-600 text-sm">Sila isi maklumat anda dengan lengkap</p>
       </div>
      </div>
      <div class="space-y-4">
       <div><label for="nama_penaja" class="block text-sm font-semibold text-emerald-900 mb-2"> Nama Penaja <span class="text-red-500">*</span> </label> <input type="text" id="nama_penaja" name="nama_penaja" required class="w-full px-4 py-3 border-2 border-emerald-200 rounded-xl focus:border-amber-400 focus:ring-2 focus:ring-amber-200 outline-none transition-all" placeholder="Nama penuh penaja">
       </div>
       <div><label for="no_telefon" class="block text-sm font-semibold text-emerald-900 mb-2"> No. Telefon <span class="text-red-500">*</span> </label> <input type="tel" id="no_telefon" name="no_telefon" required class="w-full px-4 py-3 border-2 border-emerald-200 rounded-xl focus:border-amber-400 focus:ring-2 focus:ring-amber-200 outline-none transition-all" placeholder="01X-XXXXXXX">
       </div>
       <div><label for="emel" class="block text-sm font-semibold text-emerald-900 mb-2"> Emel <span class="text-red-500">*</span> </label> <input type="email" id="emel" name="emel" required class="w-full px-4 py-3 border-2 border-emerald-200 rounded-xl focus:border-amber-400 focus:ring-2 focus:ring-amber-200 outline-none transition-all" placeholder="contoh@email.com">
       </div>
       <div><label for="catatan" class="block text-sm font-semibold text-emerald-900 mb-2"> Catatan (jika ada) </label> <textarea id="catatan" name="catatan" rows="3" class="w-full px-4 py-3 border-2 border-emerald-200 rounded-xl focus:border-amber-400 focus:ring-2 focus:ring-amber-200 outline-none transition-all resize-none" placeholder="Sebarang catatan atau permintaan khas"></textarea>
       </div>
      </div>
      <div class="mt-6 flex justify-between"><button type="button" id="back-3" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-3 rounded-xl font-semibold flex items-center transition-all">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg> Kembali </button> <button type="button" id="next-3" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold flex items-center"> Seterusnya 
        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg></button>
      </div>
     </section><!-- Step 4: Payment Upload -->
     <section id="step-4" class="hidden fade-in bg-white/95 backdrop-blur rounded-2xl shadow-xl p-6 border border-amber-200">
      <div class="flex items-center mb-6">
       <div class="bg-gradient-to-br from-amber-400 to-amber-600 p-3 rounded-xl mr-4">
        <svg class="w-6 h-6 text-emerald-900" viewbox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z" />
        </svg>
       </div>
       <div>
        <h2 class="text-xl md:text-2xl font-bold text-emerald-900">Muat Naik Resit Bayaran</h2>
        <p class="text-emerald-600 text-sm">Sila muat naik bukti pembayaran anda</p>
       </div>
      </div><!-- Bank Details -->
      <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-xl p-5 mb-6 border border-emerald-200">
       <h3 class="font-bold text-emerald-900 mb-3 flex items-center">
        <svg class="w-5 h-5 mr-2 text-emerald-700" fill="currentColor" viewbox="0 0 20 20"><path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" /> <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd" />
        </svg> Maklumat Akaun Bank</h3>
       <div class="space-y-2 text-sm">
        <p><span class="text-emerald-700 font-medium">Bank:</span> <span class="text-emerald-900 font-semibold">Bank Islam</span></p>
        <p><span class="text-emerald-700 font-medium">No. Akaun:</span> <span class="text-emerald-900 font-semibold tracking-wide">16018010005417</span></p>
        <p><span class="text-emerald-700 font-medium">Nama Akaun:</span> <span class="text-emerald-900 font-semibold">Surau Al-Furqan Presint 11 Putrajaya</span></p>
        <p><span class="text-emerald-700 font-medium">Rujukan:</span> <span class="text-amber-700 font-bold">Iftar SAF 2026</span></p>
       </div>
       <div class="mt-4 pt-4 border-t border-emerald-200 text-center">
        <p class="text-emerald-700 font-medium text-sm mb-3">QR Code Pembayaran</p>
        <img src="https://i.imgur.com/rYKB0AS.jpeg" alt="QR Code Pembayaran Bank Islam" class="mx-auto rounded-lg shadow-md max-w-[200px] w-full mb-3">
        <a id="download-qr" href="https://i.imgur.com/rYKB0AS.jpeg" download="QR_Bayaran_Surau_Al-Furqan.jpeg" class="inline-flex items-center bg-emerald-700 hover:bg-emerald-800 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all">
         <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
         Muat Turun QR Code
        </a>
       </div>
      </div><!-- Summary -->
      <div id="order-summary" class="bg-amber-50 rounded-xl p-5 mb-6 border border-amber-200">
       <h3 class="font-bold text-emerald-900 mb-3">Ringkasan Tempahan</h3>
       <div class="space-y-2 text-sm">
        <p><span class="text-emerald-700">Menu:</span> <span id="summary-menu" class="font-semibold text-emerald-900">-</span></p>
        <p><span class="text-emerald-700">Tarikh:</span> <span id="summary-date" class="font-semibold text-emerald-900">-</span></p>
        <p><span class="text-emerald-700">Nama:</span> <span id="summary-name" class="font-semibold text-emerald-900">-</span></p>
        <p class="text-lg pt-2 border-t border-amber-300"><span class="text-emerald-700">Jumlah:</span> <span id="summary-price" class="font-bold text-amber-600">RM0</span></p>
       </div>
      </div><!-- Upload Zone -->
      <div id="upload-zone" class="upload-zone rounded-xl p-8 text-center cursor-pointer mb-4"><input type="file" id="receipt-upload" accept="image/*,.pdf" class="hidden">
       <div id="upload-placeholder">
        <svg class="w-12 h-12 mx-auto text-emerald-400 mb-3" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
        </svg>
        <p class="text-emerald-700 font-medium mb-1">Klik atau seret fail ke sini</p>
        <p class="text-sm text-emerald-500">Gambar atau PDF (Saiz fail besar dibenarkan)</p>
       </div>
       <div id="upload-success" class="hidden">
        <svg class="w-12 h-12 mx-auto text-green-500 mb-3" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
        </svg>
        <p class="text-green-700 font-medium mb-1">Resit berjaya dimuat naik!</p>
        <p id="uploaded-filename" class="text-sm text-green-600"></p>
       </div>
      </div><!-- Disclaimer -->
      <div class="bg-red-50 border-2 border-red-200 rounded-xl p-4 mb-6">
       <div class="flex items-start">
        <svg class="w-6 h-6 text-red-500 mr-3 mt-0.5 flex-shrink-0" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
        <div>
         <h4 class="font-bold text-red-800 mb-1">PENTING</h4>
         <p class="text-sm text-red-700">Nama penaja hanya akan dimasukkan ke dalam jadual tajaan selepas pembayaran penuh dibuat dalam <strong>satu resit sahaja</strong>. Pembayaran secara berasingan atau deposit berperingkat <strong>tidak akan diproses</strong>.</p>
        </div>
       </div>
      </div>
      <div class="flex justify-between"><button type="button" id="back-4" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-3 rounded-xl font-semibold flex items-center transition-all">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg> Kembali </button> <button type="submit" id="submit-btn" class="btn-primary pulse-gold text-white px-8 py-3 rounded-xl font-semibold flex items-center disabled:opacity-50" disabled>
        <svg class="w-5 h-5 mr-2" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
        </svg><span id="submit-btn-text">Hantar Tempahan Tajaan</span> </button>
      </div>
     </section><!-- Success Message -->
     <section id="success-message" class="hidden fade-in bg-white/95 backdrop-blur rounded-2xl shadow-xl p-8 border border-amber-200 text-center">
      <div class="w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
       <svg class="w-10 h-10 text-white" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
       </svg>
      </div>
      <h2 class="text-2xl font-bold text-emerald-900 mb-3">Terima Kasih!</h2>
      <p class="text-emerald-700 mb-6">Tempahan anda telah berjaya dihantar.<br>
       Ia akan disahkan selepas semakan bayaran oleh pihak surau.</p>
      <div class="bg-emerald-50 rounded-xl p-4 inline-block">
       <p class="text-sm text-emerald-600">Anda akan dihubungi untuk pengesahan melalui maklumat yang diberikan.</p>
      </div><button type="button" id="new-booking-btn" class="mt-6 btn-primary text-white px-6 py-3 rounded-xl font-semibold"> Buat Tempahan Baru </button>
     </section>
    </form>
   </main><!-- Footer -->
   <footer class="bg-emerald-950/80 border-t border-amber-600/30 py-6 mt-8">
    <div class="max-w-4xl mx-auto px-4 text-center">
     <p class="text-emerald-300 text-sm mb-2">Untuk maklumat akaun bank surau, sila hubungi:</p>
     <p class="text-amber-400 font-semibold mb-3">Imam Amiruddin: <a href="tel:+60109228471" class="hover:text-amber-300 transition-colors">+60 10-922 8471</a></p><a href="https://wa.me/60109228471" target="_blank" rel="noopener noreferrer" class="inline-flex items-center bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-all transform hover:scale-105">
      <svg class="w-5 h-5 mr-2" fill="currentColor" viewbox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
      </svg> WhatsApp Imam Amiruddin </a>
     <p class="text-emerald-400 text-xs mt-4">¬© 2026 Surau Al-Furqan Presint 11, Putrajaya</p>
    </div>
   </footer><!-- Debug Button --> <button id="debug-clear-btn" class="debug-btn" title="Hapus semua data untuk testing"> üîÑ RESET DATA </button> <!-- Toast Notification -->
   <div id="toast" class="fixed top-4 right-4 z-50 hidden">
    <div class="toast bg-white rounded-xl shadow-2xl p-4 border-l-4 border-green-500 flex items-center">
     <svg class="w-6 h-6 text-green-500 mr-3" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
     </svg><span id="toast-message" class="text-gray-800 font-medium"></span>
    </div>
   </div>
  </div>
  <script>
    // ============================================================
    // GOOGLE SHEETS INTEGRATION
    // ============================================================
    // ARAHAN SETUP:
    // 1. Buka Google Sheets baru
    // 2. Namakan Sheet pertama: "Tempahan"
    // 3. Tambah header di baris 1:
    //    A1: Tarikh Tajaan | B1: Menu | C1: Harga | D1: Nama Penaja
    //    E1: No Telefon | F1: Emel | G1: Catatan | H1: Status Bayaran
    //    I1: Nama Resit | J1: Tarikh Hantar
    // 4. Buka Extensions > Apps Script
    // 5. Tampal kod dari fail google-apps-script.gs
    // 6. Deploy > New Deployment > Web App
    //    - Execute as: Me
    //    - Who has access: Anyone
    // 7. Salin URL Web App dan gantikan di bawah:
    // ============================================================

    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzDPATRUxUy0rteAZArS9HBGZE81M16ehJjUW_4eW_s3UhuFbWVHYKN_qGRKN2KdSSo/exec';

    // State
    let currentStep = 1;
    let selectedMenu = null;
    let selectedDate = null;
    let uploadedFile = null;
    let uploadedFileBase64 = null;
    let bookedDates = [];
    let localBookedDates = []; // Simpan tarikh yang baru ditempah dalam sesi ini
    let isSubmitting = false;

    const menuPrices = {
      ayam: { name: 'Menu Ayam', price: 4200 },
      daging: { name: 'Menu Daging', price: 4550 },
      kambing: { name: 'Menu Kambing', price: 4900 }
    };

    // Ramadan dates (19 Feb 2026 - 18 March 2026)
    const ramadanStart = new Date(2026, 1, 19); // Feb 19, 2026
    const ramadanEnd = new Date(2026, 2, 18); // March 18, 2026

    // Fetch booked dates from Google Sheets
    async function fetchBookedDates() {
      try {
        // Cache-bust supaya Google tidak kembalikan response lama
        const cacheBust = Date.now();
        const url = `${GOOGLE_SCRIPT_URL}?action=getBookedDates&t=${cacheBust}`;
        const response = await fetch(url, { cache: 'no-store' });
        const text = await response.text();
        console.log('Response dari Google Sheets:', text);
        let data;
        try {
          data = JSON.parse(text);
        } catch (parseErr) {
          console.error('Response bukan JSON:', text);
          return;
        }
        if (data.status === 'success') {
          // Gabungkan tarikh dari server dengan tarikh tempatan yang baru ditempah
          const serverDates = data.dates || [];
          const merged = [...new Set([...serverDates, ...localBookedDates])];
          bookedDates = merged;
          generateCalendar();
          console.log('Tarikh ditempah:', bookedDates);
        }
      } catch (err) {
        console.error('Gagal mendapatkan tarikh tempahan:', err);
      }
    }

    // Initialize app
    async function initApp() {
      setupEventListeners();
      generateCalendar();
      fetchBookedDates();
    }

    function setupEventListeners() {
      // Menu selection
      document.querySelectorAll('.menu-card').forEach(card => {
        card.addEventListener('click', () => {
          const input = card.querySelector('input[type="radio"]');
          if (input) {
            input.checked = true;
            selectedMenu = input.value;
            
            // Update UI
            document.querySelectorAll('.menu-card').forEach(c => {
              c.classList.remove('selected');
              c.querySelector('.check-icon').classList.add('hidden');
            });
            card.classList.add('selected');
            card.querySelector('.check-icon').classList.remove('hidden');
            
            document.getElementById('next-1').disabled = false;
            updateSummary();
          }
        });
      });

      // Navigation buttons
      document.getElementById('next-1').addEventListener('click', () => goToStep(2));
      document.getElementById('back-2').addEventListener('click', () => goToStep(1));
      document.getElementById('next-2').addEventListener('click', () => goToStep(3));
      document.getElementById('back-3').addEventListener('click', () => goToStep(2));
      document.getElementById('next-3').addEventListener('click', () => {
        if (validateStep3()) goToStep(4);
      });
      document.getElementById('back-4').addEventListener('click', () => goToStep(3));

      // Download QR Code
      document.getElementById('download-qr').addEventListener('click', function(e) {
        e.preventDefault();
        const link = this;
        link.textContent = 'Memuat turun...';
        fetch('https://i.imgur.com/rYKB0AS.jpeg')
          .then(res => res.blob())
          .then(blob => {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'QR_Bayaran_Surau_Al-Furqan.jpeg';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            link.innerHTML = '<svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>Muat Turun QR Code';
          })
          .catch(() => {
            // Fallback: buka dalam tab baru
            window.open('https://i.imgur.com/rYKB0AS.jpeg', '_blank');
            link.innerHTML = '<svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>Muat Turun QR Code';
          });
      });

      // File upload
      const uploadZone = document.getElementById('upload-zone');
      const fileInput = document.getElementById('receipt-upload');

      uploadZone.addEventListener('click', () => fileInput.click());
      
      uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('drag-over');
      });

      uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('drag-over');
      });

      uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('drag-over');
        const files = e.dataTransfer.files;
        if (files.length > 0) handleFileUpload(files[0]);
      });

      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) handleFileUpload(e.target.files[0]);
      });

      // Form submission
      document.getElementById('sponsorship-form').addEventListener('submit', handleSubmit);

      // New booking button
      document.getElementById('new-booking-btn').addEventListener('click', resetForm);

    }

    function generateCalendar() {
      const grid = document.getElementById('calendar-grid');
      // Keep header row
      const headers = Array.from(grid.children).slice(0, 7);
      grid.innerHTML = '';
      headers.forEach(h => grid.appendChild(h));

      // Calculate empty cells for the first day
      const firstDayOfWeek = ramadanStart.getDay();
      for (let i = 0; i < firstDayOfWeek; i++) {
        const emptyCell = document.createElement('div');
        grid.appendChild(emptyCell);
      }

      // Generate date buttons
      let currentDate = new Date(ramadanStart);
      let ramadanDay = 1;

      while (currentDate <= ramadanEnd) {
        const dateStr = formatDate(currentDate);
        const isBooked = bookedDates.includes(dateStr);
        const isSelected = selectedDate === dateStr;

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = `date-btn w-full aspect-square rounded-lg text-xs md:text-sm font-medium flex flex-col items-center justify-center ${
          isBooked 
            ? 'bg-gray-400 text-gray-600 cursor-not-allowed' 
            : isSelected 
              ? 'selected'
              : 'bg-emerald-700 text-white hover:bg-emerald-600'
        }`;
        btn.disabled = isBooked;
        btn.innerHTML = `
          <span class="font-bold">${currentDate.getDate()}</span>
          <span class="text-[10px] opacity-75">${ramadanDay} Ram</span>
        `;
        
        if (!isBooked) {
          btn.addEventListener('click', () => selectDate(dateStr, btn));
        }

        grid.appendChild(btn);
        
        currentDate.setDate(currentDate.getDate() + 1);
        ramadanDay++;
      }
    }

    function selectDate(dateStr, btn) {
      selectedDate = dateStr;
      document.getElementById('selected-date').value = dateStr;
      
      // Update UI
      document.querySelectorAll('.date-btn').forEach(b => {
        if (!b.disabled) {
          b.classList.remove('selected');
        }
      });
      btn.classList.add('selected');
      
      document.getElementById('next-2').disabled = false;
      updateSummary();
    }

    function formatDate(date) {
      const day = date.getDate().toString().padStart(2, '0');
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const year = date.getFullYear();
      return `${day}/${month}/${year}`;
    }

    function formatDateDisplay(dateStr) {
      const parts = dateStr.split('/');
      const months = ['Jan', 'Feb', 'Mac', 'Apr', 'Mei', 'Jun', 'Jul', 'Ogos', 'Sep', 'Okt', 'Nov', 'Dis'];
      return `${parts[0]} ${months[parseInt(parts[1]) - 1]} ${parts[2]}`;
    }

    function goToStep(step) {
      // Hide all steps
      for (let i = 1; i <= 4; i++) {
        document.getElementById(`step-${i}`).classList.add('hidden');
        document.getElementById(`step-${i}-indicator`).classList.remove('active', 'completed');
        document.getElementById(`step-${i}-indicator`).classList.add('bg-emerald-800', 'text-emerald-400');
      }

      // Show current step
      document.getElementById(`step-${step}`).classList.remove('hidden');
      
      // Update indicators
      for (let i = 1; i < step; i++) {
        document.getElementById(`step-${i}-indicator`).classList.remove('bg-emerald-800', 'text-emerald-400');
        document.getElementById(`step-${i}-indicator`).classList.add('completed');
      }
      document.getElementById(`step-${step}-indicator`).classList.remove('bg-emerald-800', 'text-emerald-400');
      document.getElementById(`step-${step}-indicator`).classList.add('active');

      currentStep = step;

      // Refresh tarikh setiap kali masuk step 2
      if (step === 2) {
        fetchBookedDates();
      }

      if (step === 4) {
        updateSummary();
      }
    }

    function validateStep3() {
      const nama = document.getElementById('nama_penaja').value.trim();
      const telefon = document.getElementById('no_telefon').value.trim();
      const emel = document.getElementById('emel').value.trim();

      if (!nama || !telefon || !emel) {
        showToast('Sila lengkapkan semua maklumat yang diperlukan', 'error');
        return false;
      }

      if (!/^01\d{8,9}$/.test(telefon.replace(/[-\s]/g, ''))) {
        showToast('Sila masukkan nombor telefon Malaysia yang sah (cth: 0123456789)', 'error');
        return false;
      }

      if (!isValidEmail(emel)) {
        showToast('Sila masukkan alamat emel yang sah', 'error');
        return false;
      }

      return true;
    }

    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function handleFileUpload(file) {
      // Hadkan saiz fail kepada 5MB
      if (file.size > 5 * 1024 * 1024) {
        showToast('Saiz fail melebihi 5MB. Sila muat naik fail yang lebih kecil.', 'error');
        return;
      }

      uploadedFile = file;

      // Convert ke base64 untuk dihantar ke Google Drive
      const reader = new FileReader();
      reader.onload = function(e) {
        uploadedFileBase64 = e.target.result.split(',')[1]; // buang prefix data:...
      };
      reader.readAsDataURL(file);

      document.getElementById('upload-placeholder').classList.add('hidden');
      document.getElementById('upload-success').classList.remove('hidden');
      document.getElementById('uploaded-filename').textContent = file.name;

      document.getElementById('submit-btn').disabled = false;
      showToast('Resit berjaya dimuat naik!');
    }

    function updateSummary() {
      if (selectedMenu) {
        const menu = menuPrices[selectedMenu];
        document.getElementById('summary-menu').textContent = menu.name;
        document.getElementById('summary-price').textContent = `RM${menu.price.toLocaleString()}`;
      }
      
      if (selectedDate) {
        document.getElementById('summary-date').textContent = formatDateDisplay(selectedDate);
      }

      const nama = document.getElementById('nama_penaja').value.trim();
      if (nama) {
        document.getElementById('summary-name').textContent = nama;
      }
    }

    async function handleSubmit(e) {
      e.preventDefault();

      if (isSubmitting) return;

      if (!selectedMenu || !selectedDate || !uploadedFile) {
        showToast('Sila lengkapkan semua maklumat yang diperlukan', 'error');
        return;
      }

      if (GOOGLE_SCRIPT_URL === 'GANTIKAN_DENGAN_URL_APPS_SCRIPT_ANDA') {
        showToast('URL Google Apps Script belum ditetapkan.', 'error');
        return;
      }

      isSubmitting = true;
      const submitBtn = document.getElementById('submit-btn');
      const originalText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = `
        <svg class="animate-spin w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Menghantar...
      `;

      const menu = menuPrices[selectedMenu];
      const submission = {
        tarikh_tajaan: selectedDate,
        menu_dipilih: menu.name,
        harga: menu.price,
        nama_penaja: document.getElementById('nama_penaja').value.trim(),
        no_telefon: document.getElementById('no_telefon').value.trim(),
        emel: document.getElementById('emel').value.trim(),
        catatan: document.getElementById('catatan').value.trim() || '',
        status_bayaran: 'Menunggu Pengesahan',
        resit_nama: uploadedFile ? uploadedFile.name : '',
        resit_data: uploadedFileBase64 || '',
        resit_type: uploadedFile ? uploadedFile.type : '',
        created_at: new Date().toISOString()
      };

      try {
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify(submission)
        });
        const result = await response.json();

        if (result.status === 'success') {
          // Terus tandakan tarikh ini sebagai ditempah secara tempatan
          localBookedDates.push(selectedDate);
          bookedDates.push(selectedDate);
          showSuccessMessage();
        } else if (result.status === 'duplicate') {
          showToast('Tarikh ini telah ditempah oleh penaja lain.', 'error');
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
          // Refresh booked dates
          await fetchBookedDates();
        } else {
          showToast('Ralat semasa menghantar: ' + (result.message || 'Cuba lagi.'), 'error');
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
        }
      } catch (err) {
        console.error('Submit error:', err);
        showToast('Ralat rangkaian. Sila cuba lagi.', 'error');
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }

      isSubmitting = false;
    }

    function showSuccessMessage() {
      document.getElementById('step-4').classList.add('hidden');
      document.getElementById('success-message').classList.remove('hidden');
      
      // Update all step indicators to completed
      for (let i = 1; i <= 4; i++) {
        document.getElementById(`step-${i}-indicator`).classList.remove('active', 'bg-emerald-800', 'text-emerald-400');
        document.getElementById(`step-${i}-indicator`).classList.add('completed');
      }
    }

    function resetForm() {
      // Reset state
      selectedMenu = null;
      selectedDate = null;
      uploadedFile = null;
      uploadedFileBase64 = null;

      // Reset form fields
      document.getElementById('sponsorship-form').reset();
      
      // Reset UI elements
      document.querySelectorAll('.menu-card').forEach(card => {
        card.classList.remove('selected');
        card.querySelector('.check-icon').classList.add('hidden');
      });

      document.getElementById('upload-placeholder').classList.remove('hidden');
      document.getElementById('upload-success').classList.add('hidden');
      
      document.getElementById('next-1').disabled = true;
      document.getElementById('next-2').disabled = true;
      document.getElementById('submit-btn').disabled = true;

      document.getElementById('summary-menu').textContent = '-';
      document.getElementById('summary-date').textContent = '-';
      document.getElementById('summary-name').textContent = '-';
      document.getElementById('summary-price').textContent = 'RM0';

      // Hide success and show step 1
      document.getElementById('success-message').classList.add('hidden');
      goToStep(1);
      generateCalendar();
      fetchBookedDates();
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      const toastDiv = toast.querySelector('.toast');
      
      toastMessage.textContent = message;
      
      if (type === 'error') {
        toastDiv.classList.remove('border-green-500');
        toastDiv.classList.add('border-red-500');
        toastDiv.querySelector('svg').classList.remove('text-green-500');
        toastDiv.querySelector('svg').classList.add('text-red-500');
      } else {
        toastDiv.classList.remove('border-red-500');
        toastDiv.classList.add('border-green-500');
        toastDiv.querySelector('svg').classList.remove('text-red-500');
        toastDiv.querySelector('svg').classList.add('text-green-500');
      }
      
      toast.classList.remove('hidden');
      
      setTimeout(() => {
        toast.classList.add('hidden');
      }, 3000);
    }

    // Initialize app
    initApp();
  </script>
</body>
</html>